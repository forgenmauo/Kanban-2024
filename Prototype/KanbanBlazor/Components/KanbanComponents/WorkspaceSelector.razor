@attribute [StreamRendering]
@rendermode InteractiveServer

@if (!User.Workspaces.Any()) {
    <p>Loading Workspaces...</p>
}
else {
    <div class="p-1 m-1">
        <select @onchange="HandleWorkspaceChange" class="form-select w-25">
            <option value="">Select a Workspace</option>
            @foreach (var workspace in User.Workspaces)
            {
                <option value="@workspace.Id">@workspace.Name</option>
            }
            <option value="newWorkspace">Add New Workspace</option>
        </select>
    </div>
}


@if (SelectedWorkspace.KUserId != null) {
    <CascadingValue Value="@User">
        <CascadingValue Value="@SelectedWorkspace">
            <BoardSelector />
        </CascadingValue>
    </CascadingValue>
}

@code {
    [CascadingParameter] public KUser? User { get; set; }
    [Parameter] public KWorkspace SelectedWorkspace { get; set; } = new KWorkspace();

    private void HandleWorkspaceChange(ChangeEventArgs e) {
        var w_id = e.Value.ToString();
        SelectedWorkspace = User.Workspaces.FirstOrDefault(a => a.Id.Equals(w_id)) ?? new KWorkspace();

        if (w_id == "newWorkspace" || w_id == "") {
            SelectedWorkspace = new KWorkspace();
        }
    }
}